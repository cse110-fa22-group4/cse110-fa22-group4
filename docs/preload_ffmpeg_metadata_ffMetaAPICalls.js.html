<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: preload/ffmpeg/metadata/ffMetaAPICalls.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: preload/ffmpeg/metadata/ffMetaAPICalls.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const path = require('path');
const {
	getSettings, writeSettings,
} = require('../../fs/settings/settingsAPICalls');
const {
	appendSongs,
} = require('../../fs/songs/songsAPICalls');
const {
	childProcess,
} = require('child_process');
const {
	recursiveSearchAtPath,
} = require('../../fs/fsAPICalls');

const {
	getMultiCMD,
	removeTempFile,
	ffplayPath,
	ffProbePath,
	getReadCMD,
	getWriteCMD,
	getReadCMDForSpawn,
} = require('../ffmpegAPICalls');

const {
	spawn,
} = require('child_process');
const {debugLog} = require('../../general/genAPICalls');
const {clipboard} = require('electron');
const {promises: fs} = require('fs');

// noinspection LoopStatementThatDoesntLoopJS
/**
 *
 * @param {string} filepath
 * @return {Promise&lt;string>}
 */
async function ffmpegReadPromise(filepath) {
	const data = await getReadCMDForSpawn(filepath);
	const cmd = spawn(data.cmd, data.args);
	// not sure why this is here, we need to stop using this function anyways.
	// todo: finish homemade cli app to replace this promise nightmare - liam
	// noinspection LoopStatementThatDoesntLoopJS
	for await (const d of cmd.stdout) {
		return d;
	}
	return new Promise((resolve, reject) => {
		try {
			const cmd = spawn(data.cmd, data.args, {shell: false});
			cmd.stdout.on('data', (data) => {
				resolve(data.toString());
			});
			cmd.on('error', (err) => {
				reject(err);
			});
		} catch (e) {
			reject(e);
		}
	});
}

/**
 * @name ffmpegRead
 * @description Performs an FFmpeg metadata read operation on the command line.
 * @memberOf ffmpegAPI
 * @param {string} filepath The path to the file to modify.
 * @return {Promise&lt;Object>} A json object of the read metadata
 */
async function ffmpegRead(filepath) {
	return JSON.parse(await ffmpegReadPromise(filepath));
}

/**
 * @name ffmpegWrite
 * @description Performs an FFmpeg metadata write operation on the command line.
 * @memberOf ffmpegAPI
 * @param {string} filepath The path to the file to modify.
 * @param {Promise&lt;object>} options A dictionary of tags to modify
 */
async function ffmpegWrite(filepath, options) {
	const childProcess = require('child_process');
	childProcess.execSync(await getWriteCMD(filepath, options)).toString();
	if (process.platform === 'win32') {
		childProcess.execSync('move /y out.' +
            filepath.split('.').pop() + ' ' + filepath);
	} else {
		childProcess.execSync('mv out.' +
            filepath.split('.').pop() + ' ' + filepath);
	}
}

/**
 * @return {Promise&lt;object>}
 */
async function createMultiFFmpegPromise() {
	const childProcess = require('child_process');
	const fs = require('fs').promises;
	const {debugLog} = require('../../general/genAPICalls');
	const commands = await getMultiCMD();
	return new Promise((resolve, reject) => {
		try {
			const proc = childProcess.spawn(
				commands.cmd,
				[
					'-i', commands.args.input,
					'-o', commands.args.output,
					'-p', commands.args.probe,
					'-t',
				]);
			let errFlag = false;

			proc.stdout.on('data', async (data)=> {
				if (data) {
					await debugLog(data.toString(), 'multi-ffmpeg-loading-progress');
				}
			});

			proc.stderr.on('data', async (data) => {
				errFlag = true;
				// await removeTempFile();
				reject(data.toString());
			});

			proc.on('close', async (code) => {
				if (!errFlag) {
					try {
						const fileData = await fs.readFile(commands.args.output);
						const stringData = fileData.toString();
						const data = JSON.parse(stringData);
						// await removeTempFile();
						resolve(data);
					} catch (error) {
						console.log(error);
					}
				}
			});
		} catch (e) {
			console.log(e);
			reject(e);
		}
	});
}

/**
 *
 * @return {Promise&lt;Object>}
 */
async function useMultiFFmpeg() {
	return await createMultiFFmpegPromise();
}

module.exports = {
	ffmpegRead,
	ffmpegWrite,
	useMultiFFmpeg,
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="domAPI.html">domAPI</a></li><li><a href="ffmpegAPI.html">ffmpegAPI</a></li><li><a href="fsAPI.html">fsAPI</a></li><li><a href="genAPI.html">genAPI</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addGrid">addGrid</a></li><li><a href="global.html#addPath">addPath</a></li><li><a href="global.html#addToPlaylist">addToPlaylist</a></li><li><a href="global.html#appendSongs">appendSongs</a></li><li><a href="global.html#createMultiFFmpegPromise">createMultiFFmpegPromise</a></li><li><a href="global.html#createPlaylist">createPlaylist</a></li><li><a href="global.html#editMetaData">editMetaData</a></li><li><a href="global.html#enabledTags">enabledTags</a></li><li><a href="global.html#eventHandlerLoadPhase">eventHandlerLoadPhase</a></li><li><a href="global.html#ffmpegReadPromise">ffmpegReadPromise</a></li><li><a href="global.html#findCategories">findCategories</a></li><li><a href="global.html#fsInit">fsInit</a></li><li><a href="global.html#getFile">getFile</a></li><li><a href="global.html#getMultiCMD">getMultiCMD</a></li><li><a href="global.html#getReadCMD">getReadCMD</a></li><li><a href="global.html#getReadCMDForSpawn">getReadCMDForSpawn</a></li><li><a href="global.html#getSourceFolder">getSourceFolder</a></li><li><a href="global.html#getStoragePath">getStoragePath</a></li><li><a href="global.html#getWriteCMD">getWriteCMD</a></li><li><a href="global.html#homeClick">homeClick</a></li><li><a href="global.html#htmlFromRenderer">htmlFromRenderer</a></li><li><a href="global.html#libraryAlbumsClick">libraryAlbumsClick</a></li><li><a href="global.html#libraryArtistsClick">libraryArtistsClick</a></li><li><a href="global.html#libraryClick">libraryClick</a></li><li><a href="global.html#libraryGenresClick">libraryGenresClick</a></li><li><a href="global.html#libraryTagsClick">libraryTagsClick</a></li><li><a href="global.html#onLibraryLoad">onLibraryLoad</a></li><li><a href="global.html#overviewClick">overviewClick</a></li><li><a href="global.html#ovExLyricsClick">ovExLyricsClick</a></li><li><a href="global.html#ovExQueueClick">ovExQueueClick</a></li><li><a href="global.html#ovExTrackClick">ovExTrackClick</a></li><li><a href="global.html#playlistsClick">playlistsClick</a></li><li><a href="global.html#postInit">postInit</a></li><li><a href="global.html#postLibraryLoad">postLibraryLoad</a></li><li><a href="global.html#removeTempFile">removeTempFile</a></li><li><a href="global.html#rescanClick">rescanClick</a></li><li><a href="global.html#searchAlbumsClick">searchAlbumsClick</a></li><li><a href="global.html#searchAllClick">searchAllClick</a></li><li><a href="global.html#searchArtistsClick">searchArtistsClick</a></li><li><a href="global.html#searchGenresClick">searchGenresClick</a></li><li><a href="global.html#searchPlaylistsClick">searchPlaylistsClick</a></li><li><a href="global.html#searchTagsClick">searchTagsClick</a></li><li><a href="global.html#searchTracksClick">searchTracksClick</a></li><li><a href="global.html#setStoragePath">setStoragePath</a></li><li><a href="global.html#settingsClick">settingsClick</a></li><li><a href="global.html#submitSearch">submitSearch</a></li><li><a href="global.html#testAll">testAll</a></li><li><a href="global.html#testDeleteSetting">testDeleteSetting</a></li><li><a href="global.html#testGetSettings">testGetSettings</a></li><li><a href="global.html#testSettings">testSettings</a></li><li><a href="global.html#testSongs">testSongs</a></li><li><a href="global.html#testWriteSettings">testWriteSettings</a></li><li><a href="global.html#testWriteToSetting">testWriteToSetting</a></li><li><a href="global.html#topExtensionOff">topExtensionOff</a></li><li><a href="global.html#topExtensionOn">topExtensionOn</a></li><li><a href="global.html#useMultiFFmpeg">useMultiFFmpeg</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Tue Nov 15 2022 12:54:15 GMT-0800 (Pacific Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
