

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: preload/fs/fsAPICalls.js | Source: preload/fs/fsAPICalls.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="">
        
            <img src="img/toast-ui.png" width="100%" height="100%">
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Source: preload/fs/fsAPICalls.js</a></h1>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
    <div class="lnb-api hidden"><h3>Namespaces</h3><ul><li><a href="Renderer.html">Renderer</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Renderer_sub"></div></li><li><a href="domAPI.html">domAPI</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="domAPI_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="domAPI.html#.addChild">addChild</a></li><li><a href="domAPI.html#.addEventListener">addEventListener</a></li><li><a href="domAPI.html#.addEventListenerbyClassName">addEventListenerbyClassName</a></li><li><a href="domAPI.html#.appendHTML">appendHTML</a></li><li><a href="domAPI.html#.getAttribute">getAttribute</a></li><li><a href="domAPI.html#.getProperty">getProperty</a></li><li><a href="domAPI.html#.getSelectedTracks">getSelectedTracks</a></li><li><a href="domAPI.html#.loadPage">loadPage</a></li><li><a href="domAPI.html#.setAttribute">setAttribute</a></li><li><a href="domAPI.html#.setHTML">setHTML</a></li><li><a href="domAPI.html#.setProperty">setProperty</a></li><li><a href="domAPI.html#.setStyle">setStyle</a></li><li><a href="domAPI.html#.setStyleClassToggle">setStyleClassToggle</a></li><li><a href="domAPI.html#.setThemeColor">setThemeColor</a></li></ul></div></li><li><a href="ffmpegAPI.html">ffmpegAPI</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ffmpegAPI_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ffmpegAPI.html#.binPath">binPath</a></li><li><a href="ffmpegAPI.html#.ffmpegRead">ffmpegRead</a></li><li><a href="ffmpegAPI.html#.ffmpegWrite">ffmpegWrite</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="ffmpegAPI.html#.pauseSong">pauseSong</a></li><li><a href="ffmpegAPI.html#.playSong">playSong</a></li><li><a href="ffmpegAPI.html#.resumeSong">resumeSong</a></li><li><a href="ffmpegAPI.html#.seekSong">seekSong</a></li><li><a href="ffmpegAPI.html#.stopSong">stopSong</a></li></ul></div></li><li><a href="fsAPI.html">fsAPI</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="fsAPI_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="fsAPI.html#.appendSong">appendSong</a></li><li><a href="fsAPI.html#.cullShortAudio">cullShortAudio</a></li><li><a href="fsAPI.html#.deleteSetting">deleteSetting</a></li><li><a href="fsAPI.html#.deleteStat">deleteStat</a></li><li><a href="fsAPI.html#.devClear">devClear</a></li><li><a href="fsAPI.html#.getAllPlaylists">getAllPlaylists</a></li><li><a href="fsAPI.html#.getPlaylist">getPlaylist</a></li><li><a href="fsAPI.html#.getSRCString">getSRCString</a></li><li><a href="fsAPI.html#.getSetting">getSetting</a></li><li><a href="fsAPI.html#.getSettings">getSettings</a></li><li><a href="fsAPI.html#.getSongs">getSongs</a></li><li><a href="fsAPI.html#.getSourceFolder">getSourceFolder</a></li><li><a href="fsAPI.html#.getStats">getStats</a></li><li><a href="fsAPI.html#.getStoragePath">getStoragePath</a></li><li><a href="fsAPI.html#.makeDirIfExists">makeDirIfExists</a></li><li><a href="fsAPI.html#.recursiveSearchAtPath">recursiveSearchAtPath</a></li><li><a href="fsAPI.html#.removePlaylist">removePlaylist</a></li><li><a href="fsAPI.html#.removeSong">removeSong</a></li><li><a href="fsAPI.html#.setStoragePath">setStoragePath</a></li><li><a href="fsAPI.html#.writePlaylist">writePlaylist</a></li><li><a href="fsAPI.html#.writeSettings">writeSettings</a></li><li><a href="fsAPI.html#.writeSongs">writeSongs</a></li><li><a href="fsAPI.html#.writeStats">writeStats</a></li><li><a href="fsAPI.html#.writeToSetting">writeToSetting</a></li><li><a href="fsAPI.html#.writeToStat">writeToStat</a></li></ul></div></li><li><a href="genAPI.html">genAPI</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="genAPI_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="genAPI.html#.debugLog">debugLog</a></li><li><a href="genAPI.html#.getGlobal">getGlobal</a></li><li><a href="genAPI.html#.openDialog">openDialog</a></li><li><a href="genAPI.html#.publishGlobal">publishGlobal</a></li><li><a href="genAPI.html#.removeGlobal">removeGlobal</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Global</h3><ul><li><a href="global.html#addGrid">addGrid</a></li><li><a href="global.html#addPath">addPath</a></li><li><a href="global.html#addToPlaylist">addToPlaylist</a></li><li><a href="global.html#addToQueue">addToQueue</a></li><li><a href="global.html#appendSongs">appendSongs</a></li><li><a href="global.html#changeThemeColorPrimary">changeThemeColorPrimary</a></li><li><a href="global.html#changeThemeColorSecondary">changeThemeColorSecondary</a></li><li><a href="global.html#controlSong">controlSong</a></li><li><a href="global.html#createMultiFFmpegPromise">createMultiFFmpegPromise</a></li><li><a href="global.html#createUserPlaylist">createUserPlaylist</a></li><li><a href="global.html#deletePlaylist">deletePlaylist</a></li><li><a href="global.html#editMetaData">editMetaData</a></li><li><a href="global.html#enableToggleableSetting">enableToggleableSetting</a></li><li><a href="global.html#enabledTags">enabledTags</a></li><li><a href="global.html#eventHandlerLoadPhase">eventHandlerLoadPhase</a></li><li><a href="global.html#ffmpegReadPromise">ffmpegReadPromise</a></li><li><a href="global.html#findCategories">findCategories</a></li><li><a href="global.html#generateAlbumCardList">generateAlbumCardList</a></li><li><a href="global.html#generateArtistCardList">generateArtistCardList</a></li><li><a href="global.html#generateGenreCardList">generateGenreCardList</a></li><li><a href="global.html#generateHomeCards">generateHomeCards</a></li><li><a href="global.html#generateTagCardList">generateTagCardList</a></li><li><a href="global.html#getFile">getFile</a></li><li><a href="global.html#getMetaForFields">getMetaForFields</a></li><li><a href="global.html#getMetaFromFields">getMetaFromFields</a></li><li><a href="global.html#getMultiCMD">getMultiCMD</a></li><li><a href="global.html#getPaths">getPaths</a></li><li><a href="global.html#getReadCMD">getReadCMD</a></li><li><a href="global.html#getReadCMDForSpawn">getReadCMDForSpawn</a></li><li><a href="global.html#getWriteCMD">getWriteCMD</a></li><li><a href="global.html#homeClick">homeClick</a></li><li><a href="global.html#htmlFromRenderer">htmlFromRenderer</a></li><li><a href="global.html#libraryAlbumsExtended">libraryAlbumsExtended</a></li><li><a href="global.html#libraryArtistsExtended">libraryArtistsExtended</a></li><li><a href="global.html#libraryClick">libraryClick</a></li><li><a href="global.html#libraryTagsExtended">libraryTagsExtended</a></li><li><a href="global.html#loadSettingsState">loadSettingsState</a></li><li><a href="global.html#loopSong">loopSong</a></li><li><a href="global.html#managePlaylistData">managePlaylistData</a></li><li><a href="global.html#nextSong">nextSong</a></li><li><a href="global.html#onLibraryLoad">onLibraryLoad</a></li><li><a href="global.html#onSearchPageLoad">onSearchPageLoad</a></li><li><a href="global.html#ovExLyricsClick">ovExLyricsClick</a></li><li><a href="global.html#ovExQueueClick">ovExQueueClick</a></li><li><a href="global.html#ovExTrackClick">ovExTrackClick</a></li><li><a href="global.html#overviewClick">overviewClick</a></li><li><a href="global.html#playlistManagerOff">playlistManagerOff</a></li><li><a href="global.html#playlistManagerOn">playlistManagerOn</a></li><li><a href="global.html#playlistSearch">playlistSearch</a></li><li><a href="global.html#playlistsClick">playlistsClick</a></li><li><a href="global.html#populatePlaylistAddMenu">populatePlaylistAddMenu</a></li><li><a href="global.html#postInit">postInit</a></li><li><a href="global.html#postLibraryLoad">postLibraryLoad</a></li><li><a href="global.html#prevSong">prevSong</a></li><li><a href="global.html#removeDirectory">removeDirectory</a></li><li><a href="global.html#removePlaylistSelection">removePlaylistSelection</a></li><li><a href="global.html#removeTempFile">removeTempFile</a></li><li><a href="global.html#rescanClick">rescanClick</a></li><li><a href="global.html#rescanLibraryPlaylists">rescanLibraryPlaylists</a></li><li><a href="global.html#resetCurrentPage">resetCurrentPage</a></li><li><a href="global.html#resetSidebarButtons">resetSidebarButtons</a></li><li><a href="global.html#resetSubtitleButtons">resetSubtitleButtons</a></li><li><a href="global.html#reset_all">reset_all</a></li><li><a href="global.html#reset_settings">reset_settings</a></li><li><a href="global.html#reset_songs">reset_songs</a></li><li><a href="global.html#reset_stats">reset_stats</a></li><li><a href="global.html#reset_user1">reset_user1</a></li><li><a href="global.html#reset_user2">reset_user2</a></li><li><a href="global.html#reset_user_blank">reset_user_blank</a></li><li><a href="global.html#saveMetadata">saveMetadata</a></li><li><a href="global.html#searchAlbums">searchAlbums</a></li><li><a href="global.html#searchAll">searchAll</a></li><li><a href="global.html#searchArtists">searchArtists</a></li><li><a href="global.html#searchGenres">searchGenres</a></li><li><a href="global.html#searchPlaylists">searchPlaylists</a></li><li><a href="global.html#searchTags">searchTags</a></li><li><a href="global.html#searchTracks">searchTracks</a></li><li><a href="global.html#settingsClick">settingsClick</a></li><li><a href="global.html#settingsEqual">settingsEqual</a></li><li><a href="global.html#shuffleSong">shuffleSong</a></li><li><a href="global.html#submitSearch">submitSearch</a></li><li><a href="global.html#testDeleteSetting">testDeleteSetting</a></li><li><a href="global.html#testGetSettings">testGetSettings</a></li><li><a href="global.html#testSettings">testSettings</a></li><li><a href="global.html#testWriteSettings">testWriteSettings</a></li><li><a href="global.html#testWriteToSetting">testWriteToSetting</a></li><li><a href="global.html#toggleColor">toggleColor</a></li><li><a href="global.html#toggleIcon">toggleIcon</a></li><li><a href="global.html#topExtensionOff">topExtensionOff</a></li><li><a href="global.html#topExtensionOn">topExtensionOn</a></li><li><a href="global.html#updateVolume">updateVolume</a></li><li><a href="global.html#updateWatchedFoldersDisplay">updateWatchedFoldersDisplay</a></li><li><a href="global.html#useMultiFFmpeg">useMultiFFmpeg</a></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const fs = require('fs');
const {ipcRenderer} = require('electron');
const path = require('path');
const {debugLog} = require('../general/genAPICalls');

let storagePath = '';

/**
 * @name throwErr
 * @memberOf none
 * @description Every fs async function requires
 * a callback, so this is it
 * @param err the error
 */
function throwErr(err) {
	if(err) throw err;
}

/**
 * @name throwErrOpen
 * @memberOf none
 * @description fs.open uses this
 * @param err the err
 * @fd the file descriptor
 */
async function throwErrOpen(err, fd) {
	if(err) 
		throw Error("File opening doesn't work");
	await fs.close(fd, throwErr);
	
}
/**
 * @name fsInit
 * @memberOf fsInit
 * @description MUST BE CALLED ON STARTUP. Sets the path to userData, which can
 * only be done from main.js.
 * @return {Promise&lt;void>}
 */
async function fsInit() {
	storagePath = await ipcRenderer.invoke('getUserData');
	await makeDirIfNotExists(storagePath);
	storagePath = path.join(storagePath, 'MixMatch');
	await makeDirIfNotExists(storagePath);
	await makeDirIfNotExists(path.join(storagePath, 'playlists'));
	//await debugLog('UserData Storage Path: ' + storagePath, 'fs-general');
}

/**
 * @name setStoragePath
 * @memberOf fsAPI
 * @description sets the storage path, the folder 
 * that stores settings and playlists
 * which is normally appData, to what we want
 * It's typically inside the repo
 * @param {string} newStoragePath the newStoragePath inside the repo
 * @return {Promise&lt;void>}
 */
async function setStoragePath(newStoragePath) {
	const localPath = await getSourceFolder();
	storagePath = path.join(localPath, newStoragePath);
	await makeDirIfNotExists(storagePath);
	//await debugLog('UserData Storage Path: ' + storagePath, 'fs-general');
}

/**
 * @name getStoragePath
 * @memberOf fsAPI
 * @description returns the storage path
 * @return {Promise&lt;string>} A promise containing 
 * the storage path
 */
async function getStoragePath() {
	return storagePath;
}

/**
 * @name getSourceFolder
 * @memberOf fsAPI
 * @description returns the source folder of the repo
 * @return {Promise&lt;string>} a promise containing 
 * a string of the repo's source folder
 */
async function getSourceFolder() {
	return __dirname + '/../../..';
}

/**
 * @name devClear
 * @description Deletes every file. Useful for development and unit tests.
 *              Can only be called from whitelisted callers.
 * @memberOf fsAPI
 * @param {object} caller A reference to the caller. This function can only be
 *                      called from whitelisted callers.
 * @return {Promise&lt;void>}
 */
async function devClear(caller) {
	const settingPath = path.join(storagePath, 'settings.json');
	const songsPath = path.join(storagePath, 'songs.json');
	const statsPath = path.join(storagePath, 'stats.json');
	const playlistPath = path.join(storagePath, 'playlists');

	if (fs.existsSync(settingPath)) {
		//fs.rmSync(settingPath);
		fs.rmSync(settingPath);
	}
	if (fs.existsSync(songsPath)) {
		fs.rmSync(songsPath);
	}
	if (fs.existsSync(statsPath)) {
		fs.rmSync(statsPath);
	}
	if (fs.existsSync(playlistPath)) {
		fs.rmdirSync(playlistPath, {recursive: true});
	}
}

/* File Structure in userData
.../MixMatch
    |-- playlists
    |   |-- myPlaylist.mmp
    |-- lyrics
    |   |-- myLyrics.(?)
    |-- settings.json
    |-- songs.json
    |-- stats.json
 */

/**
 * @name makeDirIfExists
 * @description Checks if a folder exists, and if not creates it.
 * @memberOf fsAPI
 * @param {string} folder The folder to be checked for.
 * @return {Promise&lt;void>}
 */
async function makeDirIfNotExists(folder) {
	await fs.opendir(folder, async (err, dir) => {
		if (err) {
			// await fs.mkdir(folder, {recursive: false}, (err) => {
			// 	// Any callback that needs to happen on first folder create
			// 	// can happen here.
			// 	if (err) throw err;
			// });

			// throw an error if it occurs
			await fs.mkdir(folder, {recursive: false}, throwErr);
		}
	});
}

/**
 * @name getSRCString
 * @description Gets a string that, when passed into the src of a HTML Audio
 * element will play the sound.
 * @memberOf fsAPI
 * @param {string} path The path to an audio file on the computer
 * @return {Promise&lt;string>} A HTML Audio compatible src string.
 * @todo May not work on all (or any) OS! May need to give filesystem access!
 */
async function getSRCString(path) {
	return 'file:///' + path;
}

// To future people trying to make recursiveSearchAtPath async: don't. seriously. it isn't worth the headache.

/**
 * @name recursiveSearchAtPath
 * @description Recursively searches every subdirectory at a given directory
 * to return every song.
 * @memberOf fsAPI
 * @param {string} searchPath The pat at which to recursively search
 * @return {Promise&lt;string[]>}  An array of every song path that exists recursively
 * within the directory.
 *
 */
async function recursiveSearchAtPath(searchPath) {
	// try and catch to take care of illegal folders/files
	try {
		const ret = [];
		const dirs = fs.readdirSync(
			searchPath,
			{withFileTypes: true},
		).filter((d) => d.isDirectory()).map((d) => d.name);

		for (const dir of dirs) {
			const dirPath = path.join(searchPath, dir);
			if (fs.existsSync(dirPath)) {
				const paths = await recursiveSearchAtPath(dirPath);
				paths.forEach((p) => ret.push(p));
			}
		}

		const files = fs.readdirSync(
			searchPath,
			{withFileTypes: true},
		).filter((d) =>
			d.isFile()).filter((d) =>
			d.name.split('.').pop() === 'mp3').map((d) => d.name);
		files.forEach((f) => ret.push(path.join(searchPath, f).split(path.sep).join(path.posix.sep)));

		return ret;
	} catch (e) {
		console.log(e);
		return [];
	}
}

module.exports = {
	getStoragePath,
	makeDirIfNotExists,
	getSRCString,
	fsInit,
	devClear,
	recursiveSearchAtPath,
	setStoragePath,
	getSourceFolder,
	throwErr,
	throwErrOpen,
};
</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="img/toast-ui.png" style="">
    <div class="footer-text">NHN Entertainment. Frontend Development Lab</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
